<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Unit XML Documentation</title>

<style>
<!-- 
h1 {
	font-family:Helvetica, Arial;
	color:#224488;
	font-size:14pt;}
	
pre {
	font-family: monospace;
}
-->
</style>

</head>
<body>

<h1>ImageFlow - Node-based Macro Editing</h1>


<p>Imageflow comes with a selection of unit-elements that can be already used in the
application to build your own workflows. Of course ImageJ has a much richer sortiment of
Plugins and Commandos, that can be translated to Imageflow. This can be done quite easily
by defining a XML-file, which serves as a description of the elements capabilities.</p>
<p>Everyone is invited to add more units and to submit them, so they can be included in
future versions.</p>


<pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br />
     
&lt;UnitDescription&gt;<br />

&lt;General&gt;<br />
  &lt;UnitName&gt;Image Calculator&lt;/UnitName&gt; </pre>
<p>Typename of the defined unit. This is also used as the default-label when the unit is inserted in
the workflow.</p>
	
	<pre>&lt;PathToIcon&gt;ImageCalculator_Unit.png&lt;/PathToIcon&gt; </pre>
<p>You can add an icon to your unit, either simply by creating an PNG with the same name as the unit-XML or by defining a name here.
The icon file is placed in the xml_icons/ folder.</p>
  
  <pre>&lt;ImageJSyntax&gt;run(&quot;Image Calculator...&quot;, &quot;image1=TITLE_1 operation=PARA_STRING_1 image2=TITLE_2 create PARA_BOOLEAN_1&quot;);&lt;/ImageJSyntax&gt; </pre>
<p>The syntax is the heart of the unit. This is an abstract form of the Macro-Command called in ImageJ.<br />The Variables define wildcards for the Parameters defined later in this XML.</p>
<p>The wildcards for the placeholders have a certain structure. 
<pre>PARA_&lt;datatype&gt;_&lt;number_of_datatype&gt;</pre>
<p>The number denotes the number of Parameter-wildcards of this datatype. This counting index starts with 1.
The different wildcards are:<p>
<ul>
<li>PARA_INTEGER_x</li>
<li>PARA_DOUBLE_x</li>
<li>PARA_STRING_x</li>
<li>PARA_BOOLEAN_x</li>
</ul>

<pre>&lt;Color&gt;0x6e91de&lt;/Color&gt;</pre>
<p>The color is in Hex-format. The unit will be drawn in this color in the workflow.</p>
  <pre>&lt;HelpString&gt;Performs a mathematical calculation of two images&lt;/HelpString&gt;</pre>
<p>The HelpString describes what this unit does in roughly one sentence.</p>
<pre>&lt;IconSize&gt;big&lt;/IconSize&gt; </pre>
<p>The representation icon on the workflow can be of different sizes. Possible are big, medium and small. 
Only big and small are implemented right now. This is handy to save screen real estate.</p>

<pre>&lt;/General&gt;</pre>

<p>Parameters are values, that influence the processing the unit does.</p>

<pre>&lt;Parameters&gt;<br />
  	&lt;Parameter&gt;<br />
  		&lt;Name&gt;Math&lt;/Name&gt;</pre>
<p>The name will be displayed in the titel of this unit's properties window.</p>
  		<pre>&lt;DataType&gt;StringArray&lt;/DataType&gt;</pre>
	<p>The DataType defines the Type of the Parameter. There are a few, which are used for
	different purposes and have different requirements to the XML-syntax.<p>
	
	<table>
	<thead>
		<th>Parameter</th>
		<th>Description</th>
		<th>XML-Requirements</th>
	</thead>
	<tbody>
		<tr>
			<td>String</td>
			<td>Stores a single String-Object</td>
			<td></td>
		</tr>
		<tr>
			<td>StringArray</td>
			<td>Stores an Array of Strings seperated by semicolons 
			  and the index of the selected item, beginning with 0.<br />
			  The wildcard for a StringArray is also "PARA_STRING_x"</td>
			<td><em>&lt;Value&gt;Red;Black;Blue;Green;Yellow&lt;/Value&gt;<br />
				&lt;ChoiceNumber&gt;0&lt;/ChoiceNumber&gt;</em></td>
		</tr>
		<tr>
			<td>boolean</td>
			<td>Stores the boolean values and a String. ImageJ-Macros can have this string inserted into the command if true.</td>
			<td><em>&lt;Value&gt;true&lt;/Value&gt;<br />
				&lt;TrueString&gt;32-bit&lt;/TrueString&gt;</em></td>
		</tr>
		<tr>
			<td>integer</td>
			<td>Stores a simple integer value.</td>
			<td></td>
		</tr>
		<tr>
			<td>double</td>
			<td>Stores a simple double value.</td>
			<td></td>
		</tr>
	</tbody>
	</table>
			
  		<pre>&lt;Value&gt;Add;Subtract;Multiply;Divide;AND;OR;XOR&lt;/Value&gt;<br />
  		&lt;HelpString&gt;Defines what math should be used to merge both images&lt;/HelpString&gt;<br />
  		&lt;ChoiceNumber&gt;1&lt;/ChoiceNumber&gt;<br />
  	&lt;/Parameter&gt;<br />
  	&lt;Parameter&gt;<br />
  		&lt;Name&gt;32 bit result&lt;/Name&gt;<br />
  		&lt;DataType&gt;boolean&lt;/DataType&gt;<br />
  		&lt;Value&gt;true&lt;/Value&gt;<br />
  		&lt;HelpString&gt;create 32 bit result?&lt;/HelpString&gt;<br />
  		&lt;TrueString&gt;32-bit&lt;/TrueString&gt;<br />
  	&lt;/Parameter&gt; 
&lt;/Parameters&gt;
</pre>

<p>Inputs are pins, which return receive the data that will be processed in this unit.
The unit can have multiple inputs.</p>

<pre>&lt;Inputs&gt; <br />
	&lt;Input&gt;<br />
		&lt;Name&gt;Input1&lt;/Name&gt;<br />
		&lt;ShortName&gt;I1&lt;/ShortName&gt;</pre>
		<p>Name and Shortname are currently not used in the interface, but exist as wildcards
		for possible additions to the User interface later on.</p>
		<pre>&lt;ImageType&gt;31&lt;/ImageType&gt;</pre>
		
	<p>An input can either have one ore more defined imagetypes.
If you want to predefine the type, use the ImageType constants defined in Imagej:</p>
<table>
	<thead>
	<tr>
		<th>Image Type</th>
		<th>Constant</th>
	</tr>
	</thead>
	<tbody>
	<tr>
		<td>8 bit greyscale</td>
		<td>1</td>
	</tr>
	<tr>
		<td>8 bit Color</td>
		<td>2</td>
	</tr>
	<tr>
		<td>16 bit greyscale</td>
		<td>4</td>
	</tr>
	<tr>
		<td>32 bit greyscale</td>
		<td>8</td>
	</tr>
	<tr>
		<td>RGB Color</td>
		<td>16</td>
	</tr>
	<tr>
		<td>All</td>
		<td>31</td>
	</tr>
	</tbody>
</table>


<p>More constants are currently not supported. To combine 
different ImageTypes, add the constants.For example:</p>
<ul>
<li>13 permits 8bit greyscale, 16bit greyscale and 32bit greyscale</li>
<li>18 permits RGB Color and 8bit RGB indexed</li>
<li>31 permits everything supported</li>
</ul>

		
		<pre>&lt;NeedToCopyInput&gt;false&lt;/NeedToCopyInput&gt;</pre>
		<p>Certain macro commands in ImageJ require this option to work. This creates a copy of the 
		image which is processed in the following units. This is required when you get
		the error message "Image -xx not found or no image open."</p>
		
	<pre>&lt;/Input&gt;<br />
	&lt;Input&gt;<br />
		&lt;Name&gt;Input2&lt;/Name&gt;<br />
		&lt;ShortName&gt;I2&lt;/ShortName&gt;	<br />
		&lt;ImageType&gt;31&lt;/ImageType&gt;<br />
		&lt;NeedToCopyInput&gt;false&lt;/NeedToCopyInput&gt;&lt;/Input&gt;<br />
&lt;/Inputs&gt;<br />
</pre>

<p>Outputs are pins, which return the result of the processing done by the unit.<br />
Theoretically more than one output is supported, but not tested. Having not output is fine as well.</p>

<pre>&lt;Outputs&gt; <br />
	&lt;Output&gt;<br />
		&lt;Name&gt;Output&lt;/Name&gt;<br />
		&lt;ShortName&gt;O&lt;/ShortName&gt;</pre>
		
<p>Name and Shortname are currently not used in the interface, but exist as wildcards
for possible additions to the User interface later on.</p>
		
		<pre>&lt;ImageType&gt;-1&lt;/ImageType&gt;</pre>

<p>An output can either have one ore more defined imagetypes or allow any kind of type.
If you want to predefine the type, use the ImageType constants defined in ImageJ as listed above.</p>

<p>You don't have to specify an output type. In most cases the output type depends on the
input type. In this case you define -1. This will return the imagetype it gets from
the first input.</p>

		<pre>&lt;DoDisplay&gt;false&lt;/DoDisplay&gt;</pre>
<p>Defines this Output as Display. In the application, at the moment only a unit is set as display.
This is because with one output there is no difference whether the option is attached
to the unit or the output. Since there is the possibility of requiring multiple outputs
in later versions and the option to display only selected outputs, this setting is defined
here.</p>
<pre>&lt;/Output&gt;<br />
&lt;/Outputs&gt;<br />

&lt;/UnitDescription&gt;	
</pre>

<p>Of course, feel free to use the existing Units as examples and as reference.</p>

<hr />

<h2>Troubleshooting</h2>

<p>I build an unit-xml and when I execute it in the graph ImageJ 
  returns the error message "Image -xx not found or no images open."</p>
<p>Your unit's input requires the setting &lt;NeedToCopyInput&gt; set to true. Read above why.</p>

<hr />
<h2>Document History</h2>
<p>Current Version 24/06/2009</p>
<table>
<thead>
<tr>
<th>Date</th>
<th>Message</th>
</tr>
</thead>
<tbody>

<tr>
<td>24/06/09</td>
<td>
<ul>
<li>Input has Required-field</li>
<li>Input and Output got DataType</li>
</ul>
</tr>

<tr>
<td>13/05/09</td>
<td>
<ul>
<li>StringArray elements seperated by Semicolon in Version 1.0, not by Space anymore</li>
<li>Added paragraph about parameter-wildcards</li>
<li>Added short paragraph about the input's NeedToCopyInput-field</li>
<li>Added troubleshooting section</li>
<li>Fixed various format issues in the document</li>
</ul>
</tr>
<tr>
<td>01/03/09</td>
<td>
<ul><li>Initial Document</li></ul></td>
</tr>
</tbody>
</body>
</html>

